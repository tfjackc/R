---
title: "Higher education % in Oregon - Alis volat propriis"
output: html_notebook
---
#### Welcome to my notebook covering the use of the tidycensus R package for extracting and evaluating census data in the state of Oregon. We are interested in uncovering the percentages of the population with graduate level degrees at a county level. 

##### Start by importing the list of libraries that will assist us in connecting with the Census Bureau's APIs and visualizing the desired data. 
```{css, echo=FALSE}
p {
  margin-bottom: 0px;
}
```
```{r message = FALSE, warning = FALSE}
library(tidycensus) # connect with the census bureau API
library(tidyverse) # data wrangling
library(mapview) # spatial data visualizer
library(plotly) # graph / chart visualizer
library(ggiraph) # graph / chart visualizer
library(ggplot2)
library(DT)
library(scales)
library(sf)
```
##### We will use the get_acs() function from tidycensus package to pull data from the census bureau. The function defaults to the 2017-2021 5-year ACS dataset. Which is necessary for us, since there are a list of counties in Oregon with a population of less than 65,000. 
```{r message = FALSE, warning = FALSE}
# Data objects needed
or_grads <- get_acs(
  geography = "county",
  variables = "DP02_0066P", 
  state = "OR",
  year = 2021,
)

or_grads_table <- or_grads %>%
  separate(NAME, into = c("county", "state"), sep = ", ") %>%
  arrange(-estimate) %>%
  select(county, estimate, moe)
```
##### We have our results in a table and we can filter through to see all counties with their percent of population with graduate degrees. Lets use the datatable() function from the DT library to provide a bit more interactivity for previewing the results.
```{r}
# function from the DT library
datatable(or_grads_table)
```
##### Top 3 counties --
<hr />
* Benton
* Multnomah
* Washington

<hr />

##### Bottom 3 counties --
<hr />
* Malheur
* Gilliam
* Morrow
```{r fig.height=6}
or_plot <- ggplot(or_grads_table, aes(x = estimate,
                                      y = reorder(county, estimate))) + 
  geom_point(color="navy", size = 3) +
  scale_x_continuous(labels = function(x) paste0(x, '%')) +
  scale_y_discrete(labels = function(x) str_remove(x, " County")) +
  labs(title = "% Population with graduate degrees, 2017-2021 ACS",
       subtitle = "Counties in Oregon",
       caption = "Data acquired with R and tidycensus",
       x = "ACS estimate",
       y = "") +
  theme_minimal(base_size = 12)
  
or_plot
```
```{r fig.height=6}
or_plot_errorbar <- ggplot(or_grads, aes(x = estimate, y = reorder(NAME, estimate))) +
  geom_errorbar(aes(xmin = estimate - moe, xmax = estimate + moe), 
                width = 0.5, linewidth = 0.5) +
  geom_point(color = "gold", size = 3) +
  scale_x_continuous(labels = function(x) paste0(x, '%')) +
  scale_y_discrete(labels = function(x) str_remove(x, " County, Oregon|, Oregon")) +
  labs(title = "% Population with graduate degrees, 2017-2021 ACS",
       subtitle = "Counties in Oregon",
       caption = "Data acquired with R and tidycensus. Error bars represent margin of error around estimates.",
       "ACS estimate",
      y = "",
      x = "Percentage") +
  theme_minimal(base_size = 12)
  
or_plot_errorbar
```
```{r}
or_income <- get_acs(
  geography = "county",
  variables = "B19013A_001",
  state = "OR",
  year = 2021,
  geometry = TRUE
)
```
```{r}
or_house <- get_acs(
  geography = "county",
  variables = "B25105_001",
  state = "OR",
  year = 2021,
  geometry = TRUE
)


```
```{r fig.height=6, fig.width=9.5}
ggplotly(or_plot_errorbar, tooltip = "x")

```

```{r  message = FALSE, warning = FALSE}
# Data objects needed
or_grads_geom <- get_acs(
  geography = "county",
  variables = "DP02_0066P", 
  state = "OR",
  year = 2021,
  geometry = TRUE
)



ggplot() + # use ggplot to create the plot.
    geom_sf(data = or_grads_geom, # use geom_sf to plot the polyline geometry.
            aes(fill = as.factor(estimate)),
            linewidth = 1) + # color based on year.
    scale_color_discrete(name = "estimate") + # set color scale
    coord_sf(datum = NA) + # put geometries on the same coordinate reference system
    theme_void()
```